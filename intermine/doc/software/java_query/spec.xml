<?xml version="1.0"?>

<article>
	<artheader>
		<date>2003-06-27</date>
		<title>Flymine - Java Query specification</title>
		<authorgroup>
			<author>
				<firstname>Matthew</firstname>
				<surname>Wakeling</surname>
			</author>
		</authorgroup>
	</artheader>

	<sect1>
		<title>Introduction</title>
		<para>This document is intended to provide information on the Java interface to the Flymine Query.
			The <ulink url="../fql_query/specification">FQL document</ulink> provides a reasonable background to the structure of the interface, since FQL maps fairly directly onto the Java interface.
			In fact, by far the easiest method of creating a Java Flymine Query object is to use the following constructor:</para>
		<programlisting>
import <ulink url="/api/org/flymine/objectstore/query/Query">org.flymine.objectstore.query.Query</ulink>;
import <ulink url="/api/org/flymine/objectstore/query/fql/FqlQuery">org.flymine.objectstore.query.fql.FqlQuery</ulink>;

Query q = new FqlQuery("--- FQL Query text ---", null).toQuery();
		</programlisting>
		<para>However, in a Java program, one will occasionally require more flexibility - the Java interface is a more direct method of inserting parameters into the Query, rather than converting them into text and expecting our parser to convert back.
			Also, there is a Query Constraint that cannot be specified in FQL - namely comparing a objectclass to a live business object - there is no useful way to represent all possible business objects in text.</para>
	</sect1>

	<sect1>
		<title>Structure</title>
		<itemizedlist>
			<listitem>The Java Query object has a From list (which is actually a Set), which can contain <ulink url="/api/org/flymine/objectstore/query/FromElement">FromElement</ulink> objects (which can be <ulink url="/api/org/flymine/objectstore/query/QueryClass">QueryClass</ulink> or <ulink url="/api/org/flymine/objectstore/query/Query">Query</ulink> objects).</listitem>
			<listitem>The object has a Select list, which can contain any <ulink url="/api/org/flymine/objectstore/query/QueryNode">QueryNode</ulink> object, which include <ulink url="/api/org/flymine/objectstore/query/QueryClass">QueryClass</ulink>, <ulink url="/api/org/flymine/objectstore/query/QueryExpression">QueryExpression</ulink>, <ulink url="/api/org/flymine/objectstore/query/QueryField">QueryField</ulink>, <ulink url="/api/org/flymine/objectstore/query/QueryFunction">QueryFunction</ulink>, and <ulink url="/api/org/flymine/objectstore/query/QueryValue">QueryValue</ulink>.</listitem>
			<listitem>The object has an Order By list, which can contain any <ulink url="/api/org/flymine/objectstore/query/QueryNode">QueryNode</ulink>.</listitem>
			<listitem>The object has a Group By list (which is actually a Set), which can contain <ulink url="/api/org/flymine/objectstore/query/QueryNode">QueryNode</ulink> objects.
				However, it does not make sense to include <ulink url="/api/org/flymine/objectstore/query/QueryValue">QueryValue</ulink> objects directly, or <ulink url="/api/org/flymine/objectstore/query/QueryFunction">QueryFunction</ulink> objects at all.</listitem>
			<listitem>The object has a reference to a <highlights>single</highlights> <ulink url="/api/org/flymine/objectstore/query/Constraint">Constraint</ulink> object, but multiple constraints can be included by encapsulating them in a <ulink url="/api/org/flymine/objectstore/query/ConstraintSet">ConstraintSet</ulink> object.</listitem>
		</itemizedlist>
	</sect1>

	<sect1>
		<title>API Javadoc</title>
		<para>The most exhaustive source of information on the Java Flymine Query interface is in the <ulink url="/api/org/flymine/objectstore/query/package-summary">API Javadoc</ulink>.
			The Flymine Query is implemented in the org.flymine.objectstore.query package.</para>
	</sect1>

	<sect1>
		<title>An Example</title>
		<para>This is an example of how one would build a Java Flymine Query object to represent the FQL query:</para>
		<programlisting>
SELECT a.field1, a.field2 FROM a WHERE a.field3 = 'Hello';
		</programlisting>
		<para>The Query is built up in stages.</para>
		<programlisting>
import <ulink url="/api/org/flymine/objectstore/query/Query">org.flymine.objectstore.query.Query</ulink>;
import <ulink url="/api/org/flymine/objectstore/query/QueryClass">org.flymine.objectstore.query.QueryClass</ulink>;
import <ulink url="/api/org/flymine/objectstore/query/QueryField">org.flymine.objectstore.query.QueryField</ulink>;
import <ulink url="/api/org/flymine/objectstore/query/QueryValue">org.flymine.objectstore.query.QueryValue</ulink>;
import <ulink url="/api/org/flymine/objectstore/query/SimpleConstraint">org.flymine.objectstore.query.SimpleConstraint</ulink>;

Query q = new Query();
QueryClass c = new QueryClass(a.class);
QueryField f1 = new QueryField(c, "field1");
QueryField f2 = new QueryField(c, "field2");
QueryField f3 = new QueryField(c, "field3");
QueryValue v = new QueryValue("Hello");
SimpleConstraint sc = new SimpleConstraint(f3, SimpleConstraint.EQUALS, v);
q.addFrom(c);
q.addToSelect(f1);
q.addToSelect(f2);
q.setConstraint(sc);
		</programlisting>
	</sect1>

</article>
